// edit.min.js
const parameterURL=new URLSearchParams(window.location.search);const idLagu=parameterURL.get('id');let dataAsli={};let thumbnailBerubah=false;async function muatDataLagu(){if(!idLagu){alert('ID Lagu tidak valid!');window.location.href='/admin';return}try{const respon=await fetch(`/api/lagu/${idLagu}`);if(!respon.ok)throw new Error('Gagal mengambil data lagu');const lagu=await respon.json();document.getElementById('judulLagu').value=lagu.judul;document.getElementById('namaArtis').value=lagu.artis;document.getElementById('deskripsiLagu').value=lagu.deskripsi;const previewThumbnail=document.getElementById('thumbnailPreview');if(lagu.thumbnail){previewThumbnail.innerHTML=`<img src="${lagu.thumbnail}" alt="Thumbnail">`}dataAsli={judul:lagu.judul,artis:lagu.artis,deskripsi:lagu.deskripsi,thumbnail:lagu.thumbnail};thumbnailBerubah=false;cekPerubahan()}catch(error){console.error('Error:',error);alert(error.message||'Terjadi kesalahan saat memuat data');window.location.href='admin.html'}}function cekPerubahan(){const judulSekarang=document.getElementById('judulLagu').value;const artisSekarang=document.getElementById('namaArtis').value;const deskripsiSekarang=document.getElementById('deskripsiLagu').value;const judulBerubah=judulSekarang!==dataAsli.judul;const artisBerubah=artisSekarang!==dataAsli.artis;const deskripsiBerubah=deskripsiSekarang!==dataAsli.deskripsi;document.getElementById('indikatorJudul').style.display=judulBerubah?'inline':'none';document.getElementById('indikatorArtis').style.display=artisBerubah?'inline':'none';document.getElementById('indikatorDeskripsi').style.display=deskripsiBerubah?'inline':'none';document.getElementById('tombolSimpan').disabled=!(judulBerubah||artisBerubah||deskripsiBerubah||thumbnailBerubah)}function unggahThumbnail(input){const file=input.files[0];if(file){if(!file.type.startsWith('image/')){alert('File harus berupa gambar!');return}const pembaca=new FileReader();pembaca.onload=function(e){document.getElementById('thumbnailPreview').innerHTML=`<img src="${e.target.result}" alt="Thumbnail">`;thumbnailBerubah=true;cekPerubahan()};pembaca.readAsDataURL(file)}}function kembaliKeAdmin(){window.location.href='admin.html'}async function konfirmasiHapus(){if(confirm('Apakah Anda yakin ingin menghapus lagu ini?')){try{const respon=await fetch(`/api/lagu/${idLagu}`,{method:'DELETE'});if(!respon.ok)throw new Error('Gagal menghapus lagu');alert('Lagu berhasil dihapus!');window.location.href='/admin'}catch(error){console.error('Error:',error);alert(error.message||'Gagal menghapus lagu')}}}async function simpanPerubahan(){const formData=new FormData();formData.append('judul',document.getElementById('judulLagu').value);formData.append('artis',document.getElementById('namaArtis').value);formData.append('deskripsi',document.getElementById('deskripsiLagu').value);const inputFile=document.getElementById('fileInput');if(inputFile.files[0]){formData.append('thumbs',inputFile.files[0])}try{const respon=await fetch(`/api/lagu/${idLagu}`,{method:'PUT',body:formData});if(!respon.ok){throw new Error('Gagal menyimpan perubahan')}alert('Perubahan berhasil disimpan!');window.location.href='admin.html'}catch(error){console.error('Error:',error);alert(error.message)}}window.onload=muatDataLagu;