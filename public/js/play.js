const audio=document.getElementById("audio"),seekbar=document.getElementById("seekbar"),currentTimeText=document.getElementById("currentTime"),durationText=document.getElementById("duration"),playBtn=document.getElementById("playBtn"),downloadBtn=document.getElementById("downloadBtn"),titleElement=document.getElementById("title"),artistElement=document.getElementById("artist"),coverElement=document.getElementById("cover");let isPlaying=!1,playlist=[],currentTrack=0;function updatePageTitle(t,e){let a=`üéµ ${t} - ${e}`;document.title=a;let n=document.querySelector('meta[property="og:title"]'),r=document.querySelector('meta[property="og:description"]');n&&n.setAttribute("content",a),r&&r.setAttribute("content",`Sedang mendengarkan ${t} - ${e}`)}function initPlayer(){window.playlistData&&window.playlistData.tracks?(playlist=window.playlistData.tracks,currentTrack=window.playlistData.currentIndex||0,playlist.length>0?loadTrack(currentTrack):showError("Tidak ada lagu dalam playlist")):showError("Gagal memuat data playlist")}function togglePlay(){audio.paused?(audio.play().catch(t=>{console.warn("Autoplay ditolak:",t),playBtn.textContent="‚ñ∂"}),playBtn.textContent="‚è∏"):(audio.pause(),playBtn.textContent="‚ñ∂")}function loadTrack(t){if(t<0||t>=playlist.length)return;let e=playlist[t];currentTrack=t,titleElement.textContent=e.title||"Judul tidak tersedia",artistElement.textContent=e.artist||"Artis tidak tersedia",coverElement.src=e.image||"/public/thumbs/default.jpg",updatePageTitle(e.title,e.artist),audio.src=e.audio_url,downloadBtn.href=e.audio_url,downloadBtn.download=`${e.title||"lagu"}.mp3`,seekbar.value=0,currentTimeText.textContent="00:00",durationText.textContent="00:00",audio.play().catch(t=>{console.log("Autoplay tidak diizinkan, menunggu interaksi pengguna"),playBtn.textContent="‚ñ∂"}),history.replaceState(null,null,`/play/${e.random_id}`)}function previousTrack(){loadTrack(currentTrack=(currentTrack-1+playlist.length)%playlist.length)}function nextTrack(){loadTrack(currentTrack=(currentTrack+1)%playlist.length)}function formatTime(t){if(isNaN(t))return"00:00";let e=Math.floor(t/60).toString().padStart(2,"0"),a=Math.floor(t%60).toString().padStart(2,"0");return`${e}:${a}`}function showError(t){titleElement.textContent=t,artistElement.textContent="",playBtn.disabled=!0,document.title=`Error - ${t}`}audio.addEventListener("play",()=>{isPlaying=!0,playBtn.textContent="‚è∏"}),audio.addEventListener("pause",()=>{isPlaying=!1,playBtn.textContent="‚ñ∂"}),audio.addEventListener("loadedmetadata",()=>{seekbar.max=Math.floor(audio.duration),durationText.textContent=formatTime(audio.duration)}),audio.addEventListener("timeupdate",()=>{seekbar.value=Math.floor(audio.currentTime),currentTimeText.textContent=formatTime(audio.currentTime)}),audio.addEventListener("ended",nextTrack),seekbar.addEventListener("input",()=>{audio.currentTime=seekbar.value}),document.addEventListener("keydown",t=>{switch(t.code){case"Space":t.preventDefault(),togglePlay();break;case"ArrowLeft":audio.currentTime=Math.max(0,audio.currentTime-5);break;case"ArrowRight":audio.currentTime=Math.min(audio.duration,audio.currentTime+5);break;case"ArrowUp":audio.volume=Math.min(1,audio.volume+.1);break;case"ArrowDown":audio.volume=Math.max(0,audio.volume-.1)}}),window.addEventListener("DOMContentLoaded",initPlayer);