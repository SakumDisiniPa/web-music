document.addEventListener("DOMContentLoaded",function(){checkAuthStatus(),loadPublicTracks(),setupSearch(),setupProfileDropdown(),initAudioPlayer()});fetch("/tracks").then(res=>res.json()).then(data=>{const container=document.getElementById("playlist-container");data.forEach(lagu=>{const div=document.createElement("div");div.className="playlist-card";const t=new Date(lagu.upload_date.replace(" ","T")).toLocaleDateString();div.innerHTML=`<a href="/play/${lagu.random_id}"><img src="${lagu.image}" alt="${lagu.name}"><div class="info"><h3>${lagu.name}</h3><p>${lagu.artist}</p><p class="description">${t}</p></div></a>`,container.appendChild(div)})}).catch(err=>{console.error(err),alert("Gagal memuat lagu.")}),document.getElementById("search-form").addEventListener("submit",function(e){e.preventDefault();const searchTerm=document.getElementById("search-input").value.toLowerCase(),tracks=document.querySelectorAll(".playlist-card");tracks.forEach(track=>{const title=track.querySelector("h3").textContent.toLowerCase(),artist=track.querySelector("p").textContent.toLowerCase(),description=track.querySelector(".description")?.textContent.toLowerCase()||"";track.style.display=title.includes(searchTerm)||artist.includes(searchTerm)||description.includes(searchTerm)?"block":"none"})});async function checkAuthStatus(){try{const response=await fetch("/api/auth/status",{credentials:"include"});if(response.ok){const data=await response.json();updateAuthUI(data.isLoggedIn,data.user)}}catch(error){console.error("Error checking auth status:",error)}}function updateAuthUI(isLoggedIn,userData=null){const authButtons=document.querySelector(".auth-buttons"),profileDropdown=document.getElementById("profile-dropdown"),premiumFeatures=document.querySelectorAll(".premium-feature");if(isLoggedIn&&profileDropdown){authButtons&&(authButtons.style.display="none"),profileDropdown.style.display="block";if(userData){const profilePic=document.getElementById("profile-picture"),usernameDisplay=document.getElementById("username-display");profilePic&&(profilePic.src=userData.profilePicture||"/public/images/default-profile.png"),usernameDisplay&&(usernameDisplay.textContent=userData.username||"User")}premiumFeatures.forEach(feature=>feature.style.display="block")}else{authButtons&&(authButtons.style.display="flex"),profileDropdown&&(profileDropdown.style.display="none"),premiumFeatures.forEach(feature=>feature.style.display="none")}}function setupProfileDropdown(){const profileButton=document.getElementById("profile-button");if(!profileButton)return;profileButton.addEventListener("click",function(e){e.stopPropagation();const content=document.getElementById("dropdown-content");content&&(content.style.display="block"===content.style.display?"none":"block")}),document.addEventListener("click",function(){const content=document.getElementById("dropdown-content");content&&(content.style.display="none")});const logoutBtn=document.getElementById("logout-btn");logoutBtn&&logoutBtn.addEventListener("click",async function(e){e.preventDefault();try{const response=await fetch("/api/auth/logout",{method:"POST",credentials:"include"});response.ok&&(window.location.href="/")}catch(error){console.error("Logout error:",error)}})}function showError(message){const container=document.getElementById("playlist-container");container&&(container.innerHTML=`<div class="error-message"><i class="fas fa-exclamation-circle"></i><p>${message}</p><button onclick="location.reload()">Coba Lagi</button></div>`)}document.addEventListener("DOMContentLoaded",()=>{const tabButtons=document.querySelectorAll(".tab-button"),tabContents=document.querySelectorAll(".tab-content");tabButtons.forEach(button=>{button.addEventListener("click",()=>{tabButtons.forEach(btn=>btn.classList.remove("active")),tabContents.forEach(content=>content.classList.remove("active")),button.classList.add("active");const tabId=button.dataset.tab;document.getElementById(`${tabId}-tab`).classList.add("active")})})});const params=new URLSearchParams(window.location.search),id=params.get("id");fetch(`/api/playlist/${id}`).then(res=>res.json()).then(data=>{document.title=data.playlist.judul,document.getElementById("playlist-title").textContent=data.playlist.judul;const container=document.getElementById("playlist-songs");data.tracks.forEach(track=>{const div=document.createElement("div");div.className="track",div.innerHTML=`<p><strong>${track.judul}</strong> - ${track.artis}</p><audio controls src="/data/audio/${track.nama_file_audio}"></audio>`,container.appendChild(div)})}),document.getElementById("login-form")?.addEventListener("submit",handleLogin),document.getElementById("register-form")?.addEventListener("submit",handleRegister);
